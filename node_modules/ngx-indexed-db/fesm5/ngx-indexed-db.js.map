{"version":3,"file":"ngx-indexed-db.js","sources":["ng://ngx-indexed-db/lib/ngx-indexed-db.ts","ng://ngx-indexed-db/utils/index.ts","ng://ngx-indexed-db/lib/ngx-indexed-db.meta.ts","ng://ngx-indexed-db/lib/ngx-indexed-db.service.ts","ng://ngx-indexed-db/lib/ngxindexeddb.module.ts"],"sourcesContent":["export interface ObjectStoreMeta {\n\tstore: string;\n\tstoreConfig: { keyPath: string; autoIncrement: boolean; [key: string]: any };\n\tstoreSchema: ObjectStoreSchema[];\n}\n\nexport interface ObjectStoreSchema {\n\tname: string;\n\tkeypath: string | string[];\n\toptions: { unique: boolean; [key: string]: any };\n}\nexport type Key = string | number | Date | ArrayBufferView | ArrayBuffer | IDBArrayKey | IDBKeyRange;\nexport interface IndexDetails {\n\tindexName: string;\n\torder: string;\n}\nexport interface RequestEventTarget<T> extends EventTarget {\n\tresult: T | T[];\n}\n\nexport interface RequestEvent<T> extends Event {\n\ttarget: RequestEventTarget<T>;\n}\n\nconst indexedDB: IDBFactory =\n\twindow.indexedDB || (<any>window).mozIndexedDB || (<any>window).webkitIndexedDB || (<any>window).msIndexedDB;\n\nexport function openDatabase(dbName: string, version: number, upgradeCallback?: Function) {\n\treturn new Promise<IDBDatabase>((resolve, reject) => {\n\t\tconst request = indexedDB.open(dbName, version);\n\t\tlet db: IDBDatabase;\n\t\trequest.onsuccess = (event: Event) => {\n\t\t\tdb = request.result;\n\t\t\tresolve(db);\n\t\t};\n\t\trequest.onerror = (event: Event) => {\n\t\t\treject(`IndexedDB error: ${request.error}`);\n\t\t};\n\t\tif (typeof upgradeCallback === 'function') {\n\t\t\trequest.onupgradeneeded = (event: Event) => {\n\t\t\t\tconsole.log('checkout');\n\t\t\t\tupgradeCallback(event, db);\n\t\t\t};\n\t\t}\n\t});\n}\n\nexport function CreateObjectStore(\n\tdbName: string,\n\tversion: number,\n\tstoreSchemas: ObjectStoreMeta[],\n\tmigrationFactory?: () => { [key: number]: (db: IDBDatabase, transaction: IDBTransaction) => void }\n) {\n\tconst request: IDBOpenDBRequest = indexedDB.open(dbName, version);\n\n\trequest.onupgradeneeded = function(event: IDBVersionChangeEvent) {\n\t\tconst database: IDBDatabase = (event.target as any).result;\n\n\t\tstoreSchemas.forEach((storeSchema: ObjectStoreMeta) => {\n\t\t\tif (!database.objectStoreNames.contains(storeSchema.store)) {\n\t\t\t\tconst objectStore = database.createObjectStore(storeSchema.store, storeSchema.storeConfig);\n\t\t\t\tstoreSchema.storeSchema.forEach((schema: ObjectStoreSchema) => {\n\t\t\t\t\tobjectStore.createIndex(schema.name, schema.keypath, schema.options);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tconst storeMigrations = migrationFactory && migrationFactory();\n\t\tif (storeMigrations) {\n\t\t\tObject.keys(storeMigrations)\n\t\t\t\t.map(k => parseInt(k, 10))\n\t\t\t\t.filter(v => v > event.oldVersion)\n\t\t\t\t.sort((a, b) => a - b)\n\t\t\t\t.forEach(v => {\n\t\t\t\t\tstoreMigrations[v](database, request.transaction);\n\t\t\t\t});\n\t\t}\n\n\t\tdatabase.close();\n\t};\n\n\trequest.onsuccess = function(e: any) {\n\t\te.target.result.close();\n\t};\n}\n\nexport enum DBMode {\n\treadonly = 'readonly',\n\treadwrite = 'readwrite'\n}\n","export interface Options {\n\tstoreName: string;\n\tdbMode: IDBTransactionMode;\n\terror: (e: Event) => any;\n\tcomplete: (e: Event) => any;\n\tabort?: any;\n}\n\nexport function validateStoreName(db: IDBDatabase, storeName: string) {\n\treturn db.objectStoreNames.contains(storeName);\n}\n\nexport function validateBeforeTransaction(db: IDBDatabase, storeName: string, reject: Function) {\n\tif (!db) {\n\t\treject('You need to use the openDatabase function to create a database before you query it!');\n\t}\n\tif (!validateStoreName(db, storeName)) {\n\t\treject(`objectStore does not exists: ${storeName}`);\n\t}\n}\n\nexport function createTransaction(db: IDBDatabase, options: Options): IDBTransaction {\n\tlet trans: IDBTransaction = db.transaction(options.storeName, options.dbMode);\n\ttrans.onerror = options.error;\n\ttrans.oncomplete = options.complete;\n\ttrans.onabort = options.abort;\n\treturn trans;\n}\n\nexport function optionsGenerator(type: any, storeName: any, reject: Function, resolve: Function): Options {\n\treturn {\n\t\tstoreName: storeName,\n\t\tdbMode: type,\n\t\terror: (e: Event) => {\n\t\t\treject(e);\n\t\t},\n\t\tcomplete: (e: Event) => {\n\t\t\tresolve();\n\t\t},\n\t\tabort: (e: Event) => {\n\t\t\treject(e);\n\t\t}\n\t};\n}\n","import { InjectionToken } from '@angular/core';\n\nexport interface DBConfig {\n\tname: string;\n\tversion: number;\n\tobjectStoresMeta: ObjectStoreMeta[];\n\tmigrationFactory?: () => { [key: number]: (db: IDBDatabase, transaction: IDBTransaction) => void };\n}\n\nexport interface ObjectStoreMeta {\n\tstore: string;\n\tstoreConfig: { keyPath: string; autoIncrement: boolean; [key: string]: any };\n\tstoreSchema: ObjectStoreSchema[];\n}\n\nexport interface ObjectStoreSchema {\n\tname: string;\n\tkeypath: string;\n\toptions: { unique: boolean; [key: string]: any };\n}\n\nexport const CONFIG_TOKEN = new InjectionToken<DBConfig>(null);\n","import { Injectable, Inject } from '@angular/core';\nimport { openDatabase, DBMode, Key, RequestEvent, CreateObjectStore } from './ngx-indexed-db';\nimport { createTransaction, optionsGenerator, validateBeforeTransaction } from '../utils';\nimport { CONFIG_TOKEN, DBConfig } from './ngx-indexed-db.meta';\n\n@Injectable()\nexport class NgxIndexedDBService {\n\tindexedDB =\n\t\twindow.indexedDB || (<any>window).mozIndexedDB || (<any>window).webkitIndexedDB || (<any>window).msIndexedDB;\n\n\tconstructor(@Inject(CONFIG_TOKEN) private dbConfig: DBConfig) {\n\t\tif (!dbConfig.name) {\n\t\t\tthrow new Error('NgxIndexedDB: Please, provide the dbName in the configuration');\n\t\t}\n\t\tif (!dbConfig.version) {\n\t\t\tthrow new Error('NgxIndexedDB: Please, provide the db version in the configuration');\n\t\t}\n\t\tCreateObjectStore(dbConfig.name, dbConfig.version, dbConfig.objectStoresMeta, dbConfig.migrationFactory);\n\t}\n\n\tadd<T>(storeName: string, value: T, key?: any) {\n\t\treturn new Promise<number>((resolve, reject) => {\n\t\t\topenDatabase(this.dbConfig.name, this.dbConfig.version).then((db: IDBDatabase) => {\n\t\t\t\tlet transaction = createTransaction(db, optionsGenerator(DBMode.readwrite, storeName, reject, resolve)),\n\t\t\t\t\tobjectStore = transaction.objectStore(storeName);\n\n\t\t\t\tlet request: IDBRequest;\n\t\t\t\tif (key) {\n\t\t\t\t\trequest = objectStore.add(value, key);\n\t\t\t\t} else {\n\t\t\t\t\trequest = objectStore.add(value);\n\t\t\t\t}\n\n\t\t\t\trequest.onsuccess = (evt: any) => {\n\t\t\t\t\tkey = evt.target.result;\n\t\t\t\t\tresolve(key);\n\t\t\t\t};\n\t\t\t});\n\t\t});\n\t}\n\n\tgetByKey<T>(storeName: string, key: any) {\n\t\treturn new Promise<any>((resolve, reject) => {\n\t\t\topenDatabase(this.dbConfig.name, this.dbConfig.version).then((db: IDBDatabase) => {\n\t\t\t\tlet transaction = createTransaction(db, optionsGenerator(DBMode.readonly, storeName, reject, resolve)),\n\t\t\t\t\tobjectStore = transaction.objectStore(storeName);\n\t\t\t\tlet request = objectStore.get(key);\n\t\t\t\trequest.onsuccess = function(event: Event) {\n\t\t\t\t\tresolve((<any>event.target).result);\n\t\t\t\t};\n\t\t\t\trequest.onerror = function(event: Event) {\n\t\t\t\t\treject(event);\n\t\t\t\t};\n\t\t\t});\n\t\t});\n\t}\n\n\tgetByID<T>(storeName: string, id: string | number) {\n\t\treturn new Promise<T>((resolve, reject) => {\n\t\t\topenDatabase(this.dbConfig.name, this.dbConfig.version).then((db: IDBDatabase) => {\n\t\t\t\tvalidateBeforeTransaction(db, storeName, reject);\n\t\t\t\tlet transaction = createTransaction(db, optionsGenerator(DBMode.readonly, storeName, reject, resolve)),\n\t\t\t\t\tobjectStore = transaction.objectStore(storeName),\n\t\t\t\t\trequest: IDBRequest;\n\t\t\t\trequest = objectStore.get(+id);\n\t\t\t\trequest.onsuccess = function(event: Event) {\n\t\t\t\t\tresolve((event.target as any).result as T);\n\t\t\t\t};\n\t\t\t});\n\t\t});\n\t}\n\n\tgetAll<T>(storeName: string) {\n\t\treturn new Promise<T[]>((resolve, reject) => {\n\t\t\topenDatabase(this.dbConfig.name, this.dbConfig.version).then(db => {\n\t\t\t\tvalidateBeforeTransaction(db, storeName, reject);\n\t\t\t\tlet transaction = createTransaction(db, optionsGenerator(DBMode.readonly, storeName, reject, resolve)),\n\t\t\t\t\tobjectStore = transaction.objectStore(storeName),\n\t\t\t\t\tresult: Array<any> = [];\n\n\t\t\t\tconst request: IDBRequest = objectStore.getAll();\n\n\t\t\t\trequest.onerror = function(e) {\n\t\t\t\t\treject(e);\n\t\t\t\t};\n\t\t\t\trequest.onsuccess = function({ target: { result: ResultAll } }: RequestEvent<T>) {\n\t\t\t\t\tresolve(ResultAll as T[]);\n\t\t\t\t};\n\t\t\t});\n\t\t});\n\t}\n\n\tupdate<T>(storeName: string, value: T, key?: any) {\n\t\treturn new Promise<any>((resolve, reject) => {\n\t\t\topenDatabase(this.dbConfig.name, this.dbConfig.version).then(db => {\n\t\t\t\tvalidateBeforeTransaction(db, storeName, reject);\n\t\t\t\tlet transaction = createTransaction(db, optionsGenerator(DBMode.readwrite, storeName, reject, resolve)),\n\t\t\t\t\tobjectStore = transaction.objectStore(storeName);\n\t\t\t\ttransaction.oncomplete = event => {\n\t\t\t\t\tresolve(event);\n\t\t\t\t};\n\t\t\t\tif (key) {\n\t\t\t\t\tobjectStore.put(value, key);\n\t\t\t\t} else {\n\t\t\t\t\tobjectStore.put(value);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tdeleteRecord(storeName: string, key: Key) {\n\t\treturn new Promise<any>((resolve, reject) => {\n\t\t\topenDatabase(this.dbConfig.name, this.dbConfig.version).then(db => {\n\t\t\t\tvalidateBeforeTransaction(db, storeName, reject);\n\t\t\t\tlet transaction = createTransaction(db, optionsGenerator(DBMode.readwrite, storeName, reject, resolve)),\n\t\t\t\t\tobjectStore = transaction.objectStore(storeName);\n\t\t\t\tlet request = objectStore.delete(key);\n\t\t\t\trequest.onsuccess = event => {\n\t\t\t\t\tresolve(event);\n\t\t\t\t};\n\t\t\t});\n\t\t});\n\t}\n\n\tclear(storeName: string) {\n\t\treturn new Promise<any>((resolve, reject) => {\n\t\t\topenDatabase(this.dbConfig.name, this.dbConfig.version).then(db => {\n\t\t\t\tvalidateBeforeTransaction(db, storeName, reject);\n\t\t\t\tlet transaction = createTransaction(db, optionsGenerator(DBMode.readwrite, storeName, reject, resolve)),\n\t\t\t\t\tobjectStore = transaction.objectStore(storeName);\n\t\t\t\tobjectStore.clear();\n\t\t\t\ttransaction.oncomplete = event => {\n\t\t\t\t\tresolve();\n\t\t\t\t};\n\t\t\t});\n\t\t});\n\t}\n\n\tdelete(storeName: string, key: any) {\n\t\treturn new Promise<any>((resolve, reject) => {\n\t\t\topenDatabase(this.dbConfig.name, this.dbConfig.version).then(db => {\n\t\t\t\tvalidateBeforeTransaction(db, storeName, reject);\n\t\t\t\tlet transaction = createTransaction(db, optionsGenerator(DBMode.readwrite, storeName, reject, resolve)),\n\t\t\t\t\tobjectStore = transaction.objectStore(storeName);\n\t\t\t\tobjectStore['delete'](key);\n\t\t\t});\n\t\t});\n\t}\n\n\tdeleteDatabase() {\n\t\treturn new Promise(async (resolve, reject) => {\n\t\t\tconst db = await openDatabase(this.dbConfig.name, this.dbConfig.version);\n\t\t\tawait db.close();\n\t\t\tconst deleteDBRequest = this.indexedDB.deleteDatabase(this.dbConfig.name);\n\t\t\tdeleteDBRequest.onsuccess = resolve;\n\t\t\tdeleteDBRequest.onerror = reject;\n\t\t\tdeleteDBRequest.onblocked = () => {\n\t\t\t\tthrow new Error(\"Unable to delete database because it's blocked\");\n\t\t\t};\n\t\t});\n\t}\n\n\topenCursor(storeName: string, cursorCallback: (event: Event) => void, keyRange?: IDBKeyRange) {\n\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\topenDatabase(this.dbConfig.name, this.dbConfig.version).then(db => {\n\t\t\t\tvalidateBeforeTransaction(db, storeName, reject);\n\t\t\t\tlet transaction = createTransaction(db, optionsGenerator(DBMode.readonly, storeName, reject, resolve)),\n\t\t\t\t\tobjectStore = transaction.objectStore(storeName),\n\t\t\t\t\trequest = objectStore.openCursor(keyRange);\n\n\t\t\t\trequest.onsuccess = (event: Event) => {\n\t\t\t\t\tcursorCallback(event);\n\t\t\t\t\tresolve();\n\t\t\t\t};\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Open a cursor by index filter.\n\t * @param storeName The name of the store to query.\n\t * @param indexName The index name to filter.\n\t * @param keyRange The range value and criteria to apply on the index.\n\t * @param cursorCallback A callback called when done.\n\t */\n\topenCursorByIndex(\n\t\tstoreName: string,\n\t\tindexName: string,\n\t\tkeyRange: IDBKeyRange,\n\t\tcursorCallback: (event: Event) => void\n\t) {\n\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\topenDatabase(this.dbConfig.name, this.dbConfig.version).then(db => {\n\t\t\t\tvalidateBeforeTransaction(db, storeName, reject);\n\t\t\t\tlet transaction = createTransaction(db, optionsGenerator(DBMode.readonly, storeName, reject, resolve)),\n\t\t\t\t\tobjectStore = transaction.objectStore(storeName),\n\t\t\t\t\tindex = objectStore.index(indexName),\n\t\t\t\t\trequest = index.openCursor(keyRange);\n\n\t\t\t\trequest.onsuccess = (event: Event) => {\n\t\t\t\t\tcursorCallback(event);\n\t\t\t\t\tresolve();\n\t\t\t\t};\n\t\t\t});\n\t\t});\n\t}\n\n\tgetByIndex(storeName: string, indexName: string, key: any) {\n\t\treturn new Promise<any>((resolve, reject) => {\n\t\t\topenDatabase(this.dbConfig.name, this.dbConfig.version).then(db => {\n\t\t\t\tvalidateBeforeTransaction(db, storeName, reject);\n\t\t\t\tlet transaction = createTransaction(db, optionsGenerator(DBMode.readonly, storeName, reject, resolve)),\n\t\t\t\t\tobjectStore = transaction.objectStore(storeName),\n\t\t\t\t\tindex = objectStore.index(indexName),\n\t\t\t\t\trequest = index.get(key);\n\t\t\t\trequest.onsuccess = (event: Event) => {\n\t\t\t\t\tresolve((<IDBOpenDBRequest>event.target).result);\n\t\t\t\t};\n\t\t\t});\n\t\t});\n\t}\n\n\tcount(storeName: string, keyRange?: IDBValidKey | IDBKeyRange) {\n\t\treturn new Promise<any>((resolve, reject) => {\n\t\t\topenDatabase(this.dbConfig.name, this.dbConfig.version).then(db => {\n\t\t\t\tvalidateBeforeTransaction(db, storeName, reject);\n\t\t\t\tlet transaction = createTransaction(db, optionsGenerator(DBMode.readonly, storeName, reject, resolve)),\n\t\t\t\t\tobjectStore = transaction.objectStore(storeName),\n\t\t\t\t\trequest: IDBRequest;\n\n\t\t\t\trequest = objectStore.count(keyRange);\n\t\t\t\trequest.onerror = e => reject(e);\n\t\t\t\trequest.onsuccess = e => resolve((<any>e.target).result);\n\t\t\t});\n\t\t});\n\t}\n}\n","import { NgModule, ModuleWithProviders, InjectionToken } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { NgxIndexedDBService } from './ngx-indexed-db.service';\nimport { DBConfig, CONFIG_TOKEN } from './ngx-indexed-db.meta';\n\n@NgModule({\n\tdeclarations: [],\n\timports: [CommonModule]\n})\nexport class NgxIndexedDBModule {\n\tstatic forRoot(dbConfig: DBConfig): ModuleWithProviders<NgxIndexedDBModule> {\n\t\treturn {\n\t\t\tngModule: NgxIndexedDBModule,\n\t\t\tproviders: [NgxIndexedDBService, { provide: CONFIG_TOKEN, useValue: dbConfig }]\n\t\t};\n\t}\n}\n"],"names":["ObjectStoreMeta","ObjectStoreSchema"],"mappings":"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"}
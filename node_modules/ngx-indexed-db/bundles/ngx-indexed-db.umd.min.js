!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define("ngx-indexed-db",["exports","@angular/core","@angular/common"],n):n((e=e||self)["ngx-indexed-db"]={},e.ng.core,e.ng.common)}(this,(function(e,n,o){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function t(e,n){var o,t,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,t&&(r=2&i[0]?t.return:i[0]?t.throw||((r=t.return)&&r.call(t),0):t.next)&&!(r=r.call(t,i[1])).done)return r;switch(t=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,t=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=n.call(e,c)}catch(e){i=[6,e],t=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}}var r=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;function i(e,n,o){return new Promise((function(t,i){var c,u=r.open(e,n);u.onsuccess=function(e){c=u.result,t(c)},u.onerror=function(e){i("IndexedDB error: "+u.error)},"function"==typeof o&&(u.onupgradeneeded=function(e){console.log("checkout"),o(e,c)})}))}var c="readonly",u="readwrite";function s(e,n,o){e||o("You need to use the openDatabase function to create a database before you query it!"),function(e,n){return e.objectStoreNames.contains(n)}(e,n)||o("objectStore does not exists: "+n)}function a(e,n){var o=e.transaction(n.storeName,n.dbMode);return o.onerror=n.error,o.oncomplete=n.complete,o.onabort=n.abort,o}function f(e,n,o,t){return{storeName:n,dbMode:e,error:function(e){o(e)},complete:function(e){t()},abort:function(e){o(e)}}}var d=new n.InjectionToken(null),l=function(){function e(e){if(this.dbConfig=e,this.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,!e.name)throw new Error("NgxIndexedDB: Please, provide the dbName in the configuration");if(!e.version)throw new Error("NgxIndexedDB: Please, provide the db version in the configuration");var n,o,t,i,c;n=e.name,o=e.version,t=e.objectStoresMeta,i=e.migrationFactory,(c=r.open(n,o)).onupgradeneeded=function(e){var n=e.target.result;t.forEach((function(e){if(!n.objectStoreNames.contains(e.store)){var o=n.createObjectStore(e.store,e.storeConfig);e.storeSchema.forEach((function(e){o.createIndex(e.name,e.keypath,e.options)}))}}));var o=i&&i();o&&Object.keys(o).map((function(e){return parseInt(e,10)})).filter((function(n){return n>e.oldVersion})).sort((function(e,n){return e-n})).forEach((function(e){o[e](n,c.transaction)})),n.close()},c.onsuccess=function(e){e.target.result.close()}}return e.prototype.add=function(e,n,o){var t=this;return new Promise((function(r,c){i(t.dbConfig.name,t.dbConfig.version).then((function(t){var i=a(t,f(u,e,c,r)).objectStore(e);(o?i.add(n,o):i.add(n)).onsuccess=function(e){o=e.target.result,r(o)}}))}))},e.prototype.getByKey=function(e,n){var o=this;return new Promise((function(t,r){i(o.dbConfig.name,o.dbConfig.version).then((function(o){var i=a(o,f(c,e,r,t)).objectStore(e).get(n);i.onsuccess=function(e){t(e.target.result)},i.onerror=function(e){r(e)}}))}))},e.prototype.getByID=function(e,n){var o=this;return new Promise((function(t,r){i(o.dbConfig.name,o.dbConfig.version).then((function(o){s(o,e,r),a(o,f(c,e,r,t)).objectStore(e).get(+n).onsuccess=function(e){t(e.target.result)}}))}))},e.prototype.getAll=function(e){var n=this;return new Promise((function(o,t){i(n.dbConfig.name,n.dbConfig.version).then((function(n){s(n,e,t);var r=a(n,f(c,e,t,o)).objectStore(e).getAll();r.onerror=function(e){t(e)},r.onsuccess=function(e){var n=e.target.result;o(n)}}))}))},e.prototype.update=function(e,n,o){var t=this;return new Promise((function(r,c){i(t.dbConfig.name,t.dbConfig.version).then((function(t){s(t,e,c);var i=a(t,f(u,e,c,r)),d=i.objectStore(e);i.oncomplete=function(e){r(e)},o?d.put(n,o):d.put(n)}))}))},e.prototype.deleteRecord=function(e,n){var o=this;return new Promise((function(t,r){i(o.dbConfig.name,o.dbConfig.version).then((function(o){s(o,e,r),a(o,f(u,e,r,t)).objectStore(e).delete(n).onsuccess=function(e){t(e)}}))}))},e.prototype.clear=function(e){var n=this;return new Promise((function(o,t){i(n.dbConfig.name,n.dbConfig.version).then((function(n){s(n,e,t);var r=a(n,f(u,e,t,o));r.objectStore(e).clear(),r.oncomplete=function(e){o()}}))}))},e.prototype.delete=function(e,n){var o=this;return new Promise((function(t,r){i(o.dbConfig.name,o.dbConfig.version).then((function(o){s(o,e,r),a(o,f(u,e,r,t)).objectStore(e).delete(n)}))}))},e.prototype.deleteDatabase=function(){var e=this;return new Promise((function(n,o){return r=e,c=void 0,s=function(){var e;return t(this,(function(t){switch(t.label){case 0:return[4,i(this.dbConfig.name,this.dbConfig.version)];case 1:return[4,t.sent().close()];case 2:return t.sent(),(e=this.indexedDB.deleteDatabase(this.dbConfig.name)).onsuccess=n,e.onerror=o,e.onblocked=function(){throw new Error("Unable to delete database because it's blocked")},[2]}}))},new((u=void 0)||(u=Promise))((function(e,n){function o(e){try{i(s.next(e))}catch(e){n(e)}}function t(e){try{i(s.throw(e))}catch(e){n(e)}}function i(n){n.done?e(n.value):new u((function(e){e(n.value)})).then(o,t)}i((s=s.apply(r,c||[])).next())}));var r,c,u,s}))},e.prototype.openCursor=function(e,n,o){var t=this;return new Promise((function(r,u){i(t.dbConfig.name,t.dbConfig.version).then((function(t){s(t,e,u),a(t,f(c,e,u,r)).objectStore(e).openCursor(o).onsuccess=function(e){n(e),r()}}))}))},e.prototype.openCursorByIndex=function(e,n,o,t){var r=this;return new Promise((function(u,d){i(r.dbConfig.name,r.dbConfig.version).then((function(r){s(r,e,d),a(r,f(c,e,d,u)).objectStore(e).index(n).openCursor(o).onsuccess=function(e){t(e),u()}}))}))},e.prototype.getByIndex=function(e,n,o){var t=this;return new Promise((function(r,u){i(t.dbConfig.name,t.dbConfig.version).then((function(t){s(t,e,u),a(t,f(c,e,u,r)).objectStore(e).index(n).get(o).onsuccess=function(e){r(e.target.result)}}))}))},e.prototype.count=function(e,n){var o=this;return new Promise((function(t,r){i(o.dbConfig.name,o.dbConfig.version).then((function(o){var i;s(o,e,r),(i=a(o,f(c,e,r,t)).objectStore(e).count(n)).onerror=function(e){return r(e)},i.onsuccess=function(e){return t(e.target.result)}}))}))},e.decorators=[{type:n.Injectable}],e.ctorParameters=function(){return[{type:void 0,decorators:[{type:n.Inject,args:[d]}]}]},e}();var b=function(){function e(){}return e.forRoot=function(n){return{ngModule:e,providers:[l,{provide:d,useValue:n}]}},e.decorators=[{type:n.NgModule,args:[{declarations:[],imports:[o.CommonModule]}]}],e}();e.CONFIG_TOKEN=d,e.NgxIndexedDBModule=b,e.NgxIndexedDBService=l,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-indexed-db.umd.min.js.map